<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neues Teil hinzufügen - Makerspace Inventar</title>
    <link rel="stylesheet" href="/public/css/styles.css">
    <style>
        .marker {
            border: 1px solid red;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Neues Teil hinzufügen</h1>

    <form action="/items" method="POST" enctype="multipart/form-data" class="item-form">
        <div class="form-group">
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required>
        </div>

        <div class="form-group">
            <label for="description">Beschreibung:</label>
            <textarea id="description" name="description" required></textarea>
        </div>

        <div class="form-group">
            <label for="room">Raum:</label>
            <input type="text" id="room" name="room" required>
        </div>

        <div class="form-group">
            <label for="cabinet">Schrank:</label>
            <input type="text" id="cabinet" name="cabinet" required>
        </div>

        <div class="form-group">
            <label for="photo">Foto:</label>
            <input type="file" id="photo" name="photo" accept="image/*">
        </div>

        <div class="coordinates-container">
            <p>Klicken Sie auf das Bild, um die Position des Teils zu markieren:</p>
            <div class="image-preview-container">
                <div id="image-preview" class="image-preview"></div>
            </div>

            <div class="form-group">
                <label for="xCoordinate">X-Koordinate:</label>
                <input type="number" id="xCoordinate" name="xCoordinate" step="0.01">
            </div>

            <div class="form-group">
                <label for="yCoordinate">Y-Koordinate:</label>
                <input type="number" id="yCoordinate" name="yCoordinate" step="0.01">
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Speichern</button>
            <a href="/items" class="btn btn-secondary">Abbrechen</a>
        </div>
    </form>
</div>

<script>
  // Bild-Vorschau und Koordinaten-Auswahl
  const photoInput = document.getElementById('photo');
  const imagePreview = document.getElementById('image-preview');
  const xCoordinateInput = document.getElementById('xCoordinate');
  const yCoordinateInput = document.getElementById('yCoordinate');

  photoInput.addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();

      reader.onload = function(e) {
        imagePreview.innerHTML = `<img src="${e.target.result}" alt="Vorschau">`;

        const img = imagePreview.querySelector('img');
        img.addEventListener('click', function(event) {
          const rect = img.getBoundingClientRect();
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;

          xCoordinateInput.value = x;
          yCoordinateInput.value = y;

          // Markierung anzeigen
          const existingMarker = imagePreview.querySelector('.marker');
          if (existingMarker) {
            existingMarker.remove();
          }

          const marker = document.createElement('div');
          marker.className = 'marker';
          marker.style.left = `${x}px`;
          marker.style.top = `${y}px`;
          imagePreview.appendChild(marker);
        });
      };

      reader.readAsDataURL(file);
    }
  });
</script>
</body>
</html>